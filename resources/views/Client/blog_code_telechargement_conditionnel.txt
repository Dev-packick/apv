@extends('layouts.client')
@section('content')

<main id="content" class="site-main post-792 page type-page status-publish hentry">
    <div class="page-content">
        <div data-elementor-type="wp-post" data-elementor-id="518" class="elementor elementor-518" data-elementor-post-type="envato_tk_templates">
            <section class="elementor-section elementor-top-section elementor-element elementor-element-517bea4 elementor-section-height-min-height elementor-section-content-middle elementor-section-boxed elementor-section-height-default elementor-section-items-middle"
                     data-id="517bea4" data-element_type="section" data-settings='{"background_background":"classic"}'
                     style="background-image: url(client/assets/img/img1.jpg);">
                <div class="elementor-background-overlay"></div>
                <div class="elementor-container elementor-column-gap-no">
                    <div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-b3e1c17"
                         data-id="b3e1c17" data-element_type="column" data-settings='{"background_background":"classic"}'>
                        <div class="elementor-widget-wrap elementor-element-populated">
                            <div class="elementor-element elementor-element-17b967e elementor-widget elementor-widget-heading"
                                 data-id="17b967e" data-element_type="widget" data-widget_type="heading.default">
                                <div class="elementor-widget-container">
                                    <h1 class="elementor-heading-title elementor-size-default">Documentation</h1>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section class="elementor-section elementor-top-section elementor-element elementor-element-32b1fb9 elementor-section-boxed elementor-section-height-default elementor-section-height-default"
                     data-id="32b1fb9" data-element_type="section">
                <div class="elementor-container elementor-column-gap-no">
                    <div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-087ad14"
                         data-id="087ad14" data-element_type="column">
                        <div class="elementor-widget-wrap elementor-element-populated">
                            <div class="elementor-element elementor-element-4ac505e elementor-widget elementor-widget-heading"
                                 data-id="4ac505e" data-element_type="widget" data-widget_type="heading.default">
                                <div class="elementor-widget-container">
                                    <h3 class="elementor-heading-title elementor-size-default" style="text-align: center; margin-top:70px;">Accédez à Nos Documents et ressources téléchargeables</h3>
                                </div>
                            </div>
                            <div class="elementor-element elementor-element-9438dfb elementor-widget elementor-widget-text-editor"
                                 data-id="9438dfb" data-element_type="widget" data-widget_type="text-editor.default">
                                <div class="elementor-widget-container">
                                    <p style="text-align: center">Bienvenue dans notre espace de documents et ressources. Vous y trouverez des fichiers utiles. Naviguez, visualisez ou téléchargez les documents en toute simplicité.</p>
                                </div>
                            </div>
                            <!-- DEBUT SECTION DOCUMENTS -->
                            <section class="elementor-section elementor-top-section elementor-element elementor-element-ca08284 elementor-section-boxed elementor-section-height-default elementor-section-height-default"
                                     data-id="ca08284" data-element_type="section" data-settings="{&quot;background_background&quot;:&quot;classic&quot;}">
                                <div class="elementor-container elementor-column-gap-no">
                                    <div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-6c94c40"
                                         data-id="6c94c40" data-element_type="column">
                                        <div class="elementor-widget-wrap elementor-element-populated">
                                            @foreach($documents->chunk(4) as $chunk)
                                            <section class="elementor-section elementor-inner-section elementor-element elementor-section-boxed"
                                                     style="margin-bottom: 30px;">
                                                <div class="elementor-container"
                                                     style="display: flex; flex-wrap: wrap; gap: 15px; justify-content: space-between;">
                                                    @foreach($chunk as $document)
                                                    <div class="elementor-column"
                                                         style="flex: 0 0 23%;box-sizing: border-box;text-align: center; padding: 10px;border: 1px solid #ddd;border-radius: 10px;background: #f9f9f9;display: flex;flex-direction: column;align-items: center;justify-content: space-between;">
                                                        <div style="margin-bottom: 10px;">
                                                            @php
                                                                $extension = pathinfo($document->file, PATHINFO_EXTENSION);
                                                                $icon = in_array($extension, ['pdf']) ? 'client/assets/img/pdficon.png' :
                                                                        (in_array($extension, ['doc', 'docx']) ? 'client/assets/img/wordicon.png' :
                                                                        (in_array($extension, ['ppt', 'pptx']) ? 'client/assets/img/powerpoint.png' :
                                                                        (in_array($extension, ['xls', 'xlsx']) ? 'client/assets/img/excelicon.png' :
                                                                        'client/assets/img/file2.jpeg')));
                                                            @endphp
                                                            <img src="{{ $icon }}" alt="Document image" width="80" height="80">
                                                        </div>
                                                        <h6 style="margin: 10px 0;font-size: 14px;font-weight: bold;text-align: center;width: 180px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
                                                            {{ $document->titre }}
                                                        </h6>
                                                        <p style="width: 180px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;margin-bottom: 10px;font-size: 12px;color: #666;text-align: center;">
                                                            {{ $document->description }}
                                                        </p>
                                                        <!-- Bouton Télécharger -->
                                                        <div style="margin-top: auto;">
                                                            <button onclick="openModal('{{ $document->titre }}', '{{ asset('storage/documentsFiles/' . $document->file) }}')"
                                                                    style="background-color:#007bff; color:white; padding:5px 15px; border:none; border-radius:5px; cursor:pointer;">
                                                                Télécharger
                                                            </button>
                                                        </div>
                                                    </div>
                                                    @endforeach
                                                </div>
                                            </section>
                                            @endforeach
                                        </div>
                                    </div>
                                </div>
                            </section>
                            <!-- FIN SECTION DOCUMENTS -->
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</main>

<!-- Modal -->
<div id="downloadModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000;">
    <div style="background:#fff; padding:20px; border-radius:8px; width:300px; text-align:center; position:relative;">
        <h4 style="margin-bottom: 20px;">Télécharger le fichier</h4>
        <form id="downloadForm">
            <input type="hidden" id="fileUrl" value="">
            <input type="text" id="nom" placeholder="Nom" required style="width:100%; padding:8px; margin-bottom:10px;">
            <input type="text" id="prenom" placeholder="Prénom" required style="width:100%; padding:8px; margin-bottom:10px;">
            <input type="email" id="email" placeholder="Email" required style="width:100%; padding:8px; margin-bottom:10px;">
            <button type="button" onclick="validateAndDownload()" style="background:#28a745; color:#fff; padding:8px 15px; border:none; cursor:pointer;">Valider</button>
            <button type="button" onclick="closeModal()" style="background:#dc3545; color:#fff; padding:8px 15px; border:none; margin-left:10px; cursor:pointer;">Annuler</button>
        </form>
    </div>
</div>

<script>
function openModal(fileName, fileUrl) {
    document.getElementById('fileUrl').value = fileUrl;
    document.getElementById('downloadModal').style.display = 'flex';
}
function closeModal() {
    document.getElementById('downloadModal').style.display = 'none';
}
function validateAndDownload() {
    const nom = document.getElementById('nom').value.trim();
    const prenom = document.getElementById('prenom').value.trim();
    const email = document.getElementById('email').value.trim();
    const fileUrl = document.getElementById('fileUrl').value;

    if (nom === '' || prenom === '' || email === '') {
        alert('Veuillez remplir tous les champs.');
        return;
    }
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        alert('Veuillez entrer une adresse email valide.');
        return;
    }
    const link = document.createElement('a');
    link.href = fileUrl;
    link.download = fileUrl.split('/').pop();
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    closeModal();
}
</script>
@endsection
